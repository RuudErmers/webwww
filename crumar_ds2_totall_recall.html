<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Crumar DS2 now Total Recall</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="jquery-migrate.min.js"></script>
<script type="text/javascript" src="owl.carousel.js"></script>
<meta name="generator" content="WordPress 4.1.1">

    <script type="text/javascript">
    jQuery(document).ready(function() {
      jQuery("#owl-demo").owlCarousel({
        autoPlay: true,
        items : 4,
        itemsDesktop : [1199,3],
        itemsDesktopSmall : [979,3]
      });

    });
    </script>
	
	
	

<link rel="stylesheet" type="text/css" href="subpage.css" media="all">
</head>
<body class="page page-child  page-template page-template-page-templates page-template-full-width-page page-template-page-templatesfull-width-page-php custom-background not-multi-author">
<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">

		<div class="site-branding">
						<div class="site-image">
				<a indepth="true" href="index.html" title="Ermers Consultancy" rel="home" class="header-image-link">
					<img src="images/header2.jpg" alt="" height="108" width="320">
				</a>
			</div><!-- .header-image -->
			
			
			<h1 class="site-title"><a indepth="true" href="index.html" title="Ermers Consultancy" rel="home">Ermers Consultancy</a></h1>

						<h2 class="site-description">Ermers Consultancy</h2>
					</div><!-- .site-branding -->

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h1 class="menu-toggle">Menu</h1>
			<div class="screen-reader-text skip-link"><a href="#content" title="Skip to content">Skip to content</a></div>

			<div class="menu-ruudmenu-container"><ul id="menu-ruudmenu" class="menu nav-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page"><a indepth="true" href="index.html">Ermers Consultancy</a></li>

<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a indepth="true" href="projects.html">Projects</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="webstack.html">Case study: Webstack modern technologies</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="embedded_webserver.html">Embedded Webserver on ARM9</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="certificate_services_in_dotnet.html">Certificate Services in .NET</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="lowpower_iot.html">Research on low power solutions for internet connected Embedded Systems</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="embedded_linux.html">Embedded Linux for Small Medium-Sized Business</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="remote_controlled_car.html">Android/Arduino remote controlled car (Educational Project)</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a indepth="true" href="iot.html">Internet Of Things</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="home_automation.html">Home Automation with Android and small embedded systems</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="multiroom_media_system.html">Android based multiroom media system (Educational project)</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="voice_control.html">Voice controlled services for remote operation of DLNA/Upnp devices</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a indepth="true" href="courses.html">Courses</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="cpp_and_uml.html">C++ and UML</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="cprogramming_and_os.html">C programming and Operating Systems</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="oop_and_ood.html">Object Oriented Programming and design</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="device_drivers.html">Device Drivers</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a indepth="true" href="midi_vst.html">MIDI/VST</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="crumar_ds2.html">Antique Crumar DS2 as controller for Cubase</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="vcb_midi_stem.html">Virtual Controller Based MIDI System</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="vst_loader.html">VST Loader</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="moog960.html">Moog 960 Software emulation</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="crumar_ds2_totall_recall.html">Crumar DS2 now Total Recall</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="total_recall_lead_synth.html">Total Recall Lead Synth Setup</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="casio_stuff.html">Android Xamarin USB Host</a></li>
<li class="menu-item menu-item-type-post_type"><a indepth="true" href="xrecds2.html">Crumar DS2 VST</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a indepth="true" href="contact.html">Contact</a>
</li>
</ul></div>		</nav><!-- #site-navigation -->
</header><!-- #masthead -->
      <div id="content" class="site-content">
        <div id="primary" class="content-area full-width">
          <div id="content" class="site-content" role="main">
            <article id="post-9" class="post-9 page type-page status-publish hentry">
              <header class="entry-header">
                <h1 class="entry-title">Crumar DS2 Now Total Recall</h1>
              </header>
              <!-- .entry-header -->
              <div class="entry-content"><p>This last year I spent a lot of time on
                making the Crumar DS2 "Total Recall". Total Recall means that
                what you see on the DS2 is exactly the same as what the values
                are in the VST it is controlling. There are almost no
                synthesizers which can do this: When you a change a patch on a
                synthesizer, the controller just shows the wrong values. This
                off course is very annoying and moreover, when you move a slider
                or rotate a button you get serious hickups.<br>
                As I stated 'I spent a lot of time' to create this option, not
                only for the DS2, but for my full DAW system. <br>
                This page will go in pretty much detail, because there are many
                problems to be tackled. But first some pictures from the outside &#9786 and inside &#9785:</p>
                
			<div id="demo">
				<div class="container">
					<div class="row">
						<div class="span12">
							<div id="owl-demo" class="owl-carousel">
								<div class="item">
				<img src="images/crumartrall.jpg" alt=""/>
			</div>	
			<div class="item">
				<img src="images/crumartrdet1.jpg" alt=""/>
			</div>	
			<div class="item">
				<img src="images/crumartrdet2.png" alt=""/>
			</div>	
			<div class="item">
				<img src="images/crumartrdet3.png" alt=""/>
			</div>	
			<div class="item">
				<img src="images/crumarins1.jpg" alt=""/>
			</div>	
			<div class="item">
				<img src="images/crumarins2.jpg" alt=""/>
			</div>	
			<div class="item">
				<img src="images/crumarins3.jpg" alt=""/>
			</div>			
							</div>
						</div>
					</div>
				</div>
			</div>
                1. Crumar DS2 visual feedback.<br>
                <br>
                The Crumar was designed as a synthesizer where you fiddle the
                knobs and then you hear immediate results: Rotate the cutoff
                controller and you hear your sound brighter. However, there is
                no visual feedback if a VSTs cutoff is changed, because the
                rotators don't act that way. Moreover, if you change a patch,
                nothing happens on the Crumar view.<br>
                To make it Total Recall I had to make a view for all
                controllers. In the picture below you can see the new Crumar
                with additional visual feedback: Almost all encoders (e.g Volume
                Oscillators) have a ledring surrounding it, showing the correct
                position, all&nbsp; selectors (e.g. LFO wave selector, OSC
                footage) have leds for the chosen position, and both Envelope
                Generators (VCF ADSR, VCA ADSR) have motorized faders. All
                encoders and selectors have been replaced with relative
                encoders: They don't have a minimum or maximum value.<br>
                <br>
                2. Crumar DS2 hardware<br>
                <br>
                Before going on, this is a good place to thank my collegue Paul
                van Venrooij, who helped a lot with designing, creating,
                destroying, recreating the hardware needed for this, and other
                projects!<br>
                <br>
                To achieve the desired functionality, about 200 connections had
                to be made from embedded hardware to the controllers: Digital
                I/O's, Led control, Neopixel control, Motor control. On the
                picture below you can the internals of the Crumar. I had no
                experience with hardware design, so all connections were
                monitored in a few Excel sheets and indeed, most connections are
                wired.<br>
                At the moment there are 7 (Arduino) controllers involved to make
                this system work. They communicate with the hardware over I2C,
                Serial, SPI, Wireless MIDI, Digital and Analog I/O. Maybe you
                think that 7 Arduino's is a bit too much and that I should have
                used something faster, like a Raspberry&nbsp; Pi. However, speed
                is not the issue, much more the large amount of control lines
                and the convenient way to split up the functionality over
                several subboards (including a way to relatively fast switch
                hardware components (like LCD, Oled, you name it)) made me
                decide to create this architecture.<br>
                <br>
                There is one Mega Arduino controlling most of the encoders,
                including a MuxShield with 48 extra I/Os. This is also the
                Arduino which handles I/O to the MIDI Arduino and
                additionally controls the 80 Neoleds in the ledrings (this is
                done with only 1 digital output, thank you Adafruit).<br>
                <br>
                There is one Mega Arduino which handles most of the analog
                connections (a few sliders plus 6 RGB Leds) and communicates
                with the Motor Arduino's. It also monitors the encoders on the
                rotators to the left of the keyboard.<br>
                <br>
                There are two Arduino UNO's controlling the Motor shields,
                needed for the ADSR faders. The Motorized faders are pretty
                delicate: They were removed from a Behringer BCF2000. At first
                the full Behringer controller was used (including two MIDI
                bridges, with optocouplers and such), but later I opted to use
                two motorshields instead of this big controller. I chose two
                Arduinos for control, because power consumption is a big issue
                here and therefor it is easier to have two simple, stable
                systems instead of a complex one. <br>
                <br>
                There is one Arduino Nano connected to the OLED and Button Patch
                Selector. This one works on 3.3Volt, which is needed by the
                OLED. For the Patch Selector (plus leds) all 20 Lines of the
                Nano are used, using a matrix construction. Paul van Venrooij
                created this hardware. <br>
                <p> </p>
                <p>There is one Arduino Pro Micro, which just serves as a Serial
                  to MIDI convertor. I used the LUFA framework here, plus some
                  HIDUINO sources but extended this to edit the Device Name over
                  SysEx control. There's also a connection to a CME WIDI
                  connector but I am not using that now. </p>
                <p>The last controller controls the keyboard, the modulation
                  wheels and aftertouch. The keyboard is&nbsp; a standard MIDI
                  keyboard from CME. Many of these keyboards use the same way of
                  interfacing. Although the keyboard was once connected to the
                  Main Arduino, I switched to the original CME Embedded board
                  for this as it gives me a comfortable feel about latency
                  issues and correct velocity sensing and aftertouch. The CME
                  board communicates with the Master Arduino over Serial port.</p>
                <p>All these 7 devices can be debugged separately because they
                  are all connected to a 7-ports HUB which communicate with the
                  Host. However, for MIDI view, there is only exactly one device
                  present, named 'Crumar DS2'.</p>
                <p>3. Embedded Software</p>
                <p>For the Embedded Software I used three essential tools: The
                  Arduino IDE, Visual Studio 2013 and Visual Micro. Most of the
                  time, the early stages of the software are done from within
                  the Arduino IDE, but when things get more complex it is wiser
                  to switch to a better IDE, which supports multiple files, easy
                  class design, code completion etcetera. Visual Studio (with
                  plugin VisualMicro) is used then. </p>
                <p>So, the main goal for the Embedded Software is to create an
                  interface from the hardware to the Midibus. You can imagine
                  there is a protocol designed with which you get notified of
                  changes on the Crumar and the other way round, let the Crumar
                  react to changes on the PC (I'll talk about the PC software in
                  the following paragraph). So, the Master Arduino receives and
                  sends command from this protocol, translates them to/from
                  messages for the Hardware classes and calls/get notified the
                  correct code, or passes data to another Arduino. I've created
                  a nice C++ framework for this which you can use in many
                  projects. As stated before, all Arduino's have there
                  individual upload port, so you can change subsystems quite
                  easily.&nbsp; With aid of the framework it is just 'filling in
                  the blanks', that is, fill in the hardware dependent parts.</p>
                <p>Since I mostly do&nbsp; the initial stuff in the Arduino IDE
                  and fix issues there, working with a processor which has no
                  debugging facilities is not too much of a burden. </p>
                <p>4. PC Software</p>
                <p>To create a full system which is total recall, it off course
                  is needed to create a framework where you can add controllers,
                  views, (bi-directional) connections to the DAW. This is my
                  other project: Virtual Controller based MIDI system. For
                  details on the virtual Controller framework and the connection
                  to DAWs see that page. For the Crumar interface, all what is
                  needed now is software which maps the MIDI control data to the
                  Virtual Controller Framework. To give an indication: In the
                  Virtual Controller Framework there is a controller named
                  Oscillator1 Wave, which can have eight different waveforms.
                  When changing a Waveform on the Crumar a protocol message
                  (BTW, all are send as Midi SysEx messages using the RMS
                  protocol) is sent which is converted to a Virtual Controller
                  Message from within a mapping class. Care must be taken to map
                  to the correct wave! </p>
                <p>Alternatively, when changing a controller in a VST (or
                  selecting another patch), the Surface controller in the DAW
                  will generate a message, which will be converted to the
                  Virtual Controller Framework and after that will be translated
                  into a SysEx message for the Crumar MIDIPort. This all sounds
                  simple, and in fact it is, but there's a lot of bookkeeping to
                  do! </p>
                <p><br>
                </p>
                <p><br>
                </p>
                <p><br>
                </p>
              </div>
              <p> </p>
              <!-- .entry-content --> </article>
            <!-- #post-## --> </div>
          <!-- #content --> </div>

	<footer id="colophon" class="site-footer">

				<div id="footer-navbar" class="footer-navbar">
			<nav id="secondary-navigation" class="subordinate-navigation" role="navigation">
				<ul id="menu-footmenu" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-239"><a indepth="true" href="index.html">Ermers Consultancy</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a indepth="true" href="contact.html">Contact</a></li>
</ul>			</nav><!-- #secondary-navigation -->
		</div><!-- #footer-navbar -->

	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript" src="navigation.js"></script>
<script type="text/javascript" src="skip-link-focus-fix.js"></script>

</body></html>

